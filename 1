(node:35360) [DEP0170] DeprecationWarning: The URL sqlite::memory: is invalid. Future versions of Node.js will throw an error.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL tests/unit/models/EventConfig.test.ts
  EventConfig Model
    Model Creation
      Ã— should create EventConfig with valid data (62 ms)
      Ã— should set default values correctly (7 ms)
      Ã— should update existing config when guild_id matches (10 ms)
      âˆš should fail without guild_id (6 ms)
      âˆš should fail without location (2 ms)
      âˆš should fail without announcement_channel_id (2 ms)
    Static Methods
      Ã— getGuildConfig() should return config for valid guild (8 ms)
      âˆš getGuildConfig() should return null for non-existent guild (3 ms)
      Ã— getEnabledConfigs() should return only enabled configurations (15 ms)
      Ã— updateSchedule() should update schedule values (7 ms)
      âˆš updateSchedule() should return null for non-existent guild (2 ms)
      Ã— toggleEnabled() should enable disabled configuration (8 ms)
      âˆš toggleEnabled() should return null for non-existent guild (5 ms)
      Ã— updateLastAnnouncement() should update timestamp (5 ms)
    Instance Methods
      Ã— getNextRunTime() should calculate next scheduled run (29 ms)
      Ã— getNextRunTime() should handle different schedules (7 ms)
      Ã— formatSchedule() should return human-readable schedule (9 ms)
      Ã— formatSchedule() should handle different schedules (5 ms)
      Ã— getCronExpression() should build valid cron expression (3 ms)
      Ã— getCronExpression() should handle different schedules (5 ms)
    Validation
      âˆš should validate schedule_day range (0-6) (6 ms)
      âˆš should validate schedule_hour range (0-23) (4 ms)
      âˆš should validate schedule_minute range (0-59) (4 ms)
    Queries
      Ã— should find by guild_id using unique constraint (4 ms)
      âˆš should enforce unique guild_id constraint (7 ms)
      âˆš should find all configurations (8 ms)
      Ã— should update configuration (9 ms)

  â— EventConfig Model â€º Model Creation â€º should create EventConfig with valid data

    expect(received).toBe(expected) // Object.is equality

    Expected: "guild-123"
    Received: undefined

    [0m [90m 45 |[39m
     [90m 46 |[39m       expect(config)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m       expect(config[33m.[39mguild_id)[33m.[39mtoBe([32m'guild-123'[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 48 |[39m       expect(config[33m.[39muser_id)[33m.[39mtoBe([32m'user-456'[39m)[33m;[39m
     [90m 49 |[39m       expect(config[33m.[39mlocation)[33m.[39mtoBe([32m'Los Angeles, CA'[39m)[33m;[39m
     [90m 50 |[39m       expect(config[33m.[39mannouncement_channel_id)[33m.[39mtoBe([32m'channel-789'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:47:31)

  â— EventConfig Model â€º Model Creation â€º should set default values correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: undefined

    [0m [90m 59 |[39m       )[33m;[39m
     [90m 60 |[39m
    [31m[1m>[22m[39m[90m 61 |[39m       expect(config[33m.[39mschedule_day)[33m.[39mtoBe([35m1[39m)[33m;[39m [90m// Monday[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 62 |[39m       expect(config[33m.[39mschedule_hour)[33m.[39mtoBe([35m12[39m)[33m;[39m [90m// Noon[39m
     [90m 63 |[39m       expect(config[33m.[39mschedule_minute)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 64 |[39m       expect(config[33m.[39mtimezone)[33m.[39mtoBe([32m'America/Los_Angeles'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:61:35)

  â— EventConfig Model â€º Model Creation â€º should update existing config when guild_id matches

    expect(received).toBe(expected) // Object.is equality

    Expected: "San Francisco, CA"
    Received: undefined

    [0m [90m 83 |[39m       )[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m       expect(updated[33m.[39mlocation)[33m.[39mtoBe([32m'San Francisco, CA'[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 86 |[39m       expect(updated[33m.[39mannouncement_channel_id)[33m.[39mtoBe([32m'channel-999'[39m)[33m;[39m
     [90m 87 |[39m
     [90m 88 |[39m       [90m// Verify only one config exists[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:85:32)

  â— EventConfig Model â€º Static Methods â€º getGuildConfig() should return config for valid guild

    expect(received).toBe(expected) // Object.is equality

    Expected: "guild-123"
    Received: undefined

    [0m [90m 133 |[39m       [36mconst[39m config [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m
     [90m 134 |[39m       expect(config)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 135 |[39m       expect(config[33m?[39m[33m.[39mguild_id)[33m.[39mtoBe([32m'guild-123'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 136 |[39m     })[33m;[39m
     [90m 137 |[39m
     [90m 138 |[39m     test([32m'getGuildConfig() should return null for non-existent guild'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:135:32)

  â— EventConfig Model â€º Static Methods â€º getEnabledConfigs() should return only enabled configurations

    expect(received).toBe(expected) // Object.is equality

    Expected: "guild-123"
    Received: undefined

    [0m [90m 161 |[39m       [36mconst[39m enabled [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetEnabledConfigs()[33m;[39m
     [90m 162 |[39m       expect(enabled)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect(enabled[[35m0[39m][33m.[39mguild_id)[33m.[39mtoBe([32m'guild-123'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m
     [90m 166 |[39m     test([32m'updateSchedule() should update schedule values'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:163:35)

  â— EventConfig Model â€º Static Methods â€º updateSchedule() should update schedule values

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: undefined

    [0m [90m 173 |[39m
     [90m 174 |[39m       [36mconst[39m updated [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mupdateSchedule([32m'guild-123'[39m[33m,[39m [35m5[39m[33m,[39m [35m18[39m[33m,[39m [35m30[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 175 |[39m       expect(updated[33m?[39m[33m.[39mschedule_day)[33m.[39mtoBe([35m5[39m)[33m;[39m [90m// Friday[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 176 |[39m       expect(updated[33m?[39m[33m.[39mschedule_hour)[33m.[39mtoBe([35m18[39m)[33m;[39m [90m// 6 PM[39m
     [90m 177 |[39m       expect(updated[33m?[39m[33m.[39mschedule_minute)[33m.[39mtoBe([35m30[39m)[33m;[39m
     [90m 178 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:175:37)

  â— EventConfig Model â€º Static Methods â€º toggleEnabled() should enable disabled configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 193 |[39m       [36mawait[39m [33mEventConfig[39m[33m.[39mtoggleEnabled([32m'guild-123'[39m[33m,[39m [36mfalse[39m)[33m;[39m
     [90m 194 |[39m       [36mlet[39m config [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 195 |[39m       expect(config[33m?[39m[33m.[39mis_enabled)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 196 |[39m
     [90m 197 |[39m       [36mawait[39m [33mEventConfig[39m[33m.[39mtoggleEnabled([32m'guild-123'[39m[33m,[39m [36mtrue[39m)[33m;[39m
     [90m 198 |[39m       config [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:195:34)

  â— EventConfig Model â€º Static Methods â€º updateLastAnnouncement() should update timestamp

    expect(received).toBeNull()

    Received: undefined

    [0m [90m 214 |[39m
     [90m 215 |[39m       [36mconst[39m beforeUpdate [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 216 |[39m       expect(beforeUpdate[33m?[39m[33m.[39mlast_announcement)[33m.[39mtoBeNull()[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 217 |[39m
     [90m 218 |[39m       [36mawait[39m [33mEventConfig[39m[33m.[39mupdateLastAnnouncement([32m'guild-123'[39m)[33m;[39m
     [90m 219 |[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:216:47)

  â— EventConfig Model â€º Instance Methods â€º getNextRunTime() should calculate next scheduled run

    Invalid unit value NaN

    [0m [90m 213 |[39m     }
     [90m 214 |[39m
    [31m[1m>[22m[39m[90m 215 |[39m     next [33m=[39m next[33m.[39mplus({ days[33m:[39m daysUntilTarget })[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 216 |[39m     [36mreturn[39m next[33m.[39mtoJSDate()[33m;[39m
     [90m 217 |[39m   }
     [90m 218 |[39m[0m

      at asNumber (../node_modules/luxon/src/impl/util.js:288:11)
      at asNumber (../node_modules/luxon/src/impl/util.js:298:35)
      at Function.normalizeObject [as fromObject] (../node_modules/luxon/src/duration.js:297:15)
      at Function.fromObject [as fromDurationLike] (../node_modules/luxon/src/duration.js:320:23)
      at DateTime.fromDurationLike [as plus] (../node_modules/luxon/src/datetime.js:1677:26)
      at EventConfig.getNextRunTime (database/models/EventConfig.ts:215:17)
      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:235:30)

  â— EventConfig Model â€º Instance Methods â€º getNextRunTime() should handle different schedules

    Invalid unit value NaN

    [0m [90m 213 |[39m     }
     [90m 214 |[39m
    [31m[1m>[22m[39m[90m 215 |[39m     next [33m=[39m next[33m.[39mplus({ days[33m:[39m daysUntilTarget })[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 216 |[39m     [36mreturn[39m next[33m.[39mtoJSDate()[33m;[39m
     [90m 217 |[39m   }
     [90m 218 |[39m[0m

      at asNumber (../node_modules/luxon/src/impl/util.js:288:11)
      at asNumber (../node_modules/luxon/src/impl/util.js:298:35)
      at Function.normalizeObject [as fromObject] (../node_modules/luxon/src/duration.js:297:15)
      at Function.fromObject [as fromDurationLike] (../node_modules/luxon/src/duration.js:320:23)
      at DateTime.fromDurationLike [as plus] (../node_modules/luxon/src/datetime.js:1677:26)
      at EventConfig.getNextRunTime (database/models/EventConfig.ts:215:17)
      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:260:38)

  â— EventConfig Model â€º Instance Methods â€º formatSchedule() should return human-readable schedule

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 225 |[39m     [36mconst[39m hour [33m=[39m [36mthis[39m[33m.[39mschedule_hour [33m===[39m [35m0[39m [33m?[39m [35m12[39m [33m:[39m [36mthis[39m[33m.[39mschedule_hour [33m>[39m [35m12[39m [33m?[39m [36mthis[39m[33m.[39mschedule_hour [33m-[39m [35m12[39m [33m:[39m [36mthis[39m[33m.[39mschedule_hour[33m;[39m
     [90m 226 |[39m     [36mconst[39m ampm [33m=[39m [36mthis[39m[33m.[39mschedule_hour [33m<[39m [35m12[39m [33m?[39m [32m'AM'[39m [33m:[39m [32m'PM'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 227 |[39m     [36mconst[39m minute [33m=[39m [36mthis[39m[33m.[39mschedule_minute[33m.[39mtoString()[33m.[39mpadStart([35m2[39m[33m,[39m [32m'0'[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 228 |[39m
     [90m 229 |[39m     [36mreturn[39m [32m`${dayName}s at ${hour}:${minute} ${ampm} (${this.timezone})`[39m[33m;[39m
     [90m 230 |[39m   }[0m

      at EventConfig.formatSchedule (database/models/EventConfig.ts:227:41)
      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:276:32)

  â— EventConfig Model â€º Instance Methods â€º formatSchedule() should handle different schedules

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 225 |[39m     [36mconst[39m hour [33m=[39m [36mthis[39m[33m.[39mschedule_hour [33m===[39m [35m0[39m [33m?[39m [35m12[39m [33m:[39m [36mthis[39m[33m.[39mschedule_hour [33m>[39m [35m12[39m [33m?[39m [36mthis[39m[33m.[39mschedule_hour [33m-[39m [35m12[39m [33m:[39m [36mthis[39m[33m.[39mschedule_hour[33m;[39m
     [90m 226 |[39m     [36mconst[39m ampm [33m=[39m [36mthis[39m[33m.[39mschedule_hour [33m<[39m [35m12[39m [33m?[39m [32m'AM'[39m [33m:[39m [32m'PM'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 227 |[39m     [36mconst[39m minute [33m=[39m [36mthis[39m[33m.[39mschedule_minute[33m.[39mtoString()[33m.[39mpadStart([35m2[39m[33m,[39m [32m'0'[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 228 |[39m
     [90m 229 |[39m     [36mreturn[39m [32m`${dayName}s at ${hour}:${minute} ${ampm} (${this.timezone})`[39m[33m;[39m
     [90m 230 |[39m   }[0m

      at EventConfig.formatSchedule (database/models/EventConfig.ts:227:41)
      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:292:40)

  â— EventConfig Model â€º Instance Methods â€º getCronExpression() should build valid cron expression

    TypeError: config.getCronExpression is not a function

    [0m [90m 303 |[39m       )[33m;[39m
     [90m 304 |[39m
    [31m[1m>[22m[39m[90m 305 |[39m       [36mconst[39m cron [33m=[39m config[33m.[39mgetCronExpression()[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 306 |[39m       expect(cron)[33m.[39mtoBe([32m'0 12 * * 1'[39m)[33m;[39m [90m// Every Monday at noon[39m
     [90m 307 |[39m     })[33m;[39m
     [90m 308 |[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:305:27)

  â— EventConfig Model â€º Instance Methods â€º getCronExpression() should handle different schedules

    TypeError: updatedConfig.getCronExpression is not a function

    [0m [90m 318 |[39m       [36mconst[39m updatedConfig [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m
     [90m 319 |[39m
    [31m[1m>[22m[39m[90m 320 |[39m       [36mconst[39m cron [33m=[39m updatedConfig[33m![39m[33m.[39mgetCronExpression()[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 321 |[39m       expect(cron)[33m.[39mtoBe([32m'30 18 * * 5'[39m)[33m;[39m [90m// Every Friday at 6:30 PM[39m
     [90m 322 |[39m     })[33m;[39m
     [90m 323 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:320:35)

  â— EventConfig Model â€º Queries â€º should find by guild_id using unique constraint

    expect(received).toBe(expected) // Object.is equality

    Expected: "guild-123"
    Received: undefined

    [0m [90m 384 |[39m       [36mconst[39m config [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mfindOne({ where[33m:[39m { guild_id[33m:[39m [32m'guild-123'[39m } })[33m;[39m
     [90m 385 |[39m       expect(config)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 386 |[39m       expect(config[33m?[39m[33m.[39mguild_id)[33m.[39mtoBe([32m'guild-123'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 387 |[39m     })[33m;[39m
     [90m 388 |[39m
     [90m 389 |[39m     test([32m'should enforce unique guild_id constraint'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:386:32)

  â— EventConfig Model â€º Queries â€º should update configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: "San Diego, CA"
    Received: undefined

    [0m [90m 428 |[39m
     [90m 429 |[39m       [36mconst[39m updated [33m=[39m [36mawait[39m [33mEventConfig[39m[33m.[39mgetGuildConfig([32m'guild-123'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 430 |[39m       expect(updated[33m?[39m[33m.[39mlocation)[33m.[39mtoBe([32m'San Diego, CA'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 431 |[39m     })[33m;[39m
     [90m 432 |[39m   })[33m;[39m
     [90m 433 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/models/EventConfig.test.ts:430:33)

Test Suites: 1 failed, 1 total
Tests:       16 failed, 11 passed, 27 total
Snapshots:   0 total
Time:        1.849 s
Ran all test suites matching EventConfig.test.ts.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\lukaf\Desktop\Dev Work\My Projects\Bwaincell\backend
npm error workspace @bwaincell/backend@1.0.0
npm error location C:\Users\lukaf\Desktop\Dev Work\My Projects\Bwaincell\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c jest EventConfig.test.ts

